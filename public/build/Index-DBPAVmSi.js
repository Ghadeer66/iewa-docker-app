import{e as i,o as n,a as e,t as r,p as C,j as H,i as w,r as c,k as $,c as I,w as L,g as M,f as g,d as m,v as b,F as N,h as A}from"./app-AVBF0kRs.js";const O={class:"min-h-screen bg-gray-100"},T={class:"bg-white shadow-sm border-b"},X={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},q={class:"flex justify-between items-center py-4"},G={class:"flex items-center space-x-4 space-x-reverse"},J={class:"text-gray-700 mx-4"},K={__name:"BusinessAppLayout",setup(y){const p=()=>{w.post("/business/logout")};return(x,u)=>(n(),i("div",O,[e("header",T,[e("div",X,[e("div",q,[u[1]||(u[1]=e("div",{class:"flex items-center"},[e("h1",{class:"text-2xl font-bold text-blue-600"},"پنل شرکت")],-1)),e("div",G,[e("span",J,r(x.$page.props.auth.user.business_name),1),e("button",{onClick:p,class:"flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white font-medium px-5 py-2 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-red-400"},u[0]||(u[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h4a2 2 0 012 2v1"})],-1),C(" خروج ",-1)]))])])])]),e("main",null,[H(x.$slots,"default")])]))}},P={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Q={class:"bg-white overflow-hidden shadow rounded-lg mb-8"},R={class:"px-4 py-5 sm:p-6"},W={class:"text-lg font-semibold text-gray-900"},Y={class:"mt-2 text-sm text-gray-600"},Z={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ee={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},se={class:"px-6 py-6"},te={class:"block"},le={class:"relative border-2 border-dashed rounded-xl p-6 text-center hover:bg-gray-50 transition"},oe={class:"text-gray-600"},ae={key:0,class:"mt-2 text-xs text-gray-500 truncate"},ne={class:"flex items-center gap-3"},re=["disabled"],de={class:"min-h-5"},ie={key:0,class:"text-sm text-green-600"},ue={key:1,class:"text-sm text-red-600"},ce={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},pe={class:"px-6 py-6"},xe=["disabled"],me={class:"md:col-span-2 flex items-center gap-3 mt-2"},be=["disabled"],ve={class:"min-h-5"},ge={key:0,class:"text-sm text-green-600"},ye={key:1,class:"text-sm text-red-600"},fe={class:"mt-8"},he={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},we={class:"px-6 py-6"},_e={key:0,class:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden text-black"},ke={class:"divide-y divide-gray-200"},Ce={class:"flex-1"},Ve={class:"text-sm font-semibold text-gray-800"},$e={class:"text-xs text-gray-500 mt-0.5"},Me={class:"flex items-center gap-2"},je=["onClick"],Se=["onClick"],Ee={key:1,class:"text-sm text-gray-500 bg-gray-50 border border-dashed border-gray-300 rounded-xl p-4 text-center"},ze={key:2,class:"fixed inset-0 flex items-center justify-center z-50"},Be={class:"bg-white rounded-xl shadow-lg p-6 z-10 w-full max-w-md"},Ue={class:"space-y-3"},Fe={key:3,class:"fixed inset-0 flex items-center justify-center z-50"},De={class:"bg-white rounded-xl shadow-lg p-6 z-10 w-full max-w-sm"},He={class:"flex justify-end gap-3"},Le={__name:"Index",props:{user:Object,stats:Object},setup(y){const p=c(null),x=c(!1),u=c(""),f=c(""),j=t=>{p.value=t.target.files?.[0]||null},S=async()=>{if(u.value="",f.value="",!p.value){f.value="لطفاً فایل CSV را انتخاب کنید";return}const t=new FormData;t.append("file",p.value),x.value=!0;try{await w.post("/business/employees/upload",t,{forceFormData:!0,onSuccess:s=>{u.value=s?.props?.flash?.message||"آپلود انجام شد",p.value=null},onError:s=>{f.value=s?.file?.[0]||s?.message||"خطا در آپلود"},onFinish:()=>{x.value=!1}})}catch{f.value="خطای غیرمنتظره در آپلود",x.value=!1}},l=$({personal_code:"",max_price:null,percentage:null,starts_at:"",ends_at:""}),h=c(!1),_=c(""),d=c(""),k=c(null),v=c(null),a=$({id:null,name:"",personal_code:"",phone:""}),E=t=>{k.value=t.id,a.id=t.id,a.name=t.name||"",a.personal_code=t.personal_code||"",a.phone=t.phone||""},V=()=>{k.value=null,a.id=null},z=async()=>{try{await w.put(`/business/employees/${a.id}`,{name:a.name,personal_code:a.personal_code,phone:a.phone},{onSuccess:t=>{k.value=null},onError:t=>{console.error(t)}})}catch(t){console.error(t)}},B=t=>{v.value=t},U=async()=>{if(v.value)try{await w.delete(`/business/employees/${v.value.id}`,{onSuccess:()=>{v.value=null},onError:t=>{console.error(t)}})}catch(t){console.error(t)}},F=async()=>{if(_.value="",d.value="",!l.personal_code||l.max_price==null||l.percentage==null){d.value="کد پرسنلی، سقف خرید و درصد الزامی است";return}l.max_price=Math.min(Math.max(l.max_price,0),5e6),l.percentage=Math.min(Math.max(l.percentage,0),100),h.value=!0;try{await w.post("/business/employees/subsidy-by-code",{personal_code:l.personal_code,max_price:l.max_price,percentage:l.percentage,starts_at:l.starts_at||null,ends_at:l.ends_at||null},{onSuccess:t=>{_.value=t?.props?.flash?.message||"سوبسید ذخیره شد"},onError:t=>{t?.personal_code?.[0]?d.value="کد پرسنلی پیدا نشد":t?.max_price?.[0]?d.value="سقف خرید مشخص نیست ":t?.percentage?.[0]?d.value="درصد سوبسید مشخص نیست ":t?.starts_at?.[0]?d.value="از تاریخ مشخص نیست ":t?.ends_at?.[0]?d.value="تا تاریخ مشخص نیست ":t?.message?d.value=t.message:d.value="خطا در ذخیره"},onFinish:()=>{h.value=!1}})}catch{d.value="خطای غیرمنتظره",h.value=!1}};return(t,s)=>(n(),I(K,null,{default:L(()=>[e("div",P,[e("div",Q,[e("div",R,[e("h2",W,"خوش آمدید، "+r(y.user.name),1),e("p",Y,"شما به عنوان نماینده "+r(y.user.business_name)+" وارد شده‌اید. ",1)])]),e("div",Z,[e("div",ee,[e("div",se,[s[14]||(s[14]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-blue-50 text-blue-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 3a2 2 0 00-2 2v8a2 2 0 002 2h4l2 2 2-2h2a2 2 0 002-2V9l-5-6H4z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"آپلود کارکنان (CSV)"),e("p",{class:"text-xs text-gray-500"},"ستون‌های لازم: name, phone, personal code")])],-1)),e("form",{onSubmit:M(S,["prevent"]),class:"space-y-4"},[e("label",te,[s[13]||(s[13]=e("span",{class:"block text-sm text-gray-700 mb-2"},"فایل CSV",-1)),e("div",le,[e("input",{type:"file",accept:".csv,.txt",onChange:j,class:"absolute inset-0 opacity-0 cursor-pointer"},null,32),e("div",oe,[s[12]||(s[12]=e("span",{class:"text-sm"},"فایل را اینجا رها کنید یا برای انتخاب کلیک کنید",-1)),p.value?(n(),i("div",ae,r(p.value.name),1)):g("",!0)])])]),e("div",ne,[e("button",{disabled:x.value,type:"submit",class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 cursor-pointer"},r(x.value?"در حال آپلود...":"آپلود"),9,re)]),e("div",de,[u.value?(n(),i("span",ie,r(u.value),1)):g("",!0),f.value?(n(),i("span",ue,r(f.value),1)):g("",!0)])],32)])]),e("div",ce,[e("div",pe,[s[20]||(s[20]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-emerald-50 text-emerald-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11V5H9v2H7v2h2v2h2v-2h2V7h-2z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"تعریف سوبسید کارمند"),e("p",{class:"text-xs text-gray-500"},"کد پرسنلی را وارد کنید و درصد را تنظیم کنید")])],-1)),e("form",{onSubmit:M(F,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end text-black"},[e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm text-gray-700 mb-1"},"کد پرسنلی کاربر",-1)),m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>l.personal_code=o),type:"text",class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"مثلاً XA123"},null,512),[[b,l.personal_code]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm text-gray-700 mb-1"},"سقف خرید نفر (تومان)",-1)),m(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>l.max_price=o),type:"number",min:"0",max:"5000000",onInput:s[2]||(s[2]=o=>l.max_price=Math.min(l.max_price||0,5e6)),class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"0 - 5,000,000"},null,544),[[b,l.max_price,void 0,{number:!0}]])]),e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm text-gray-700 mb-1"},"درصد سوبسید",-1)),m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>l.percentage=o),type:"number",min:"0",max:"100",disabled:!l.max_price,onInput:s[4]||(s[4]=o=>l.percentage=Math.min(Math.max(l.percentage||0,0),100)),class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"0-100"},null,40,xe),[[b,l.percentage,void 0,{number:!0}]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm text-gray-700 mb-1"},"از تاریخ",-1)),m(e("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>l.starts_at=o),type:"date",class:"w-full border rounded-lg px-3 py-2"},null,512),[[b,l.starts_at]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm text-gray-700 mb-1"},"تا تاریخ",-1)),m(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>l.ends_at=o),type:"date",class:"w-full border rounded-lg px-3 py-2"},null,512),[[b,l.ends_at]])]),e("div",me,[e("button",{disabled:h.value||!l.max_price||!l.percentage,type:"submit",class:"px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white disabled:opacity-50 cursor-pointer"},r(h.value?"در حال ذخیره...":"ذخیره سوبسید"),9,be),e("div",ve,[_.value?(n(),i("span",ge,r(_.value),1)):g("",!0),d.value?(n(),i("span",ye,r(d.value),1)):g("",!0)])])],32)])])]),e("div",fe,[e("div",he,[e("div",we,[s[29]||(s[29]=e("div",{class:"flex items-center justify-between mb-4"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-gray-50 text-gray-700"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13 7a3 3 0 11-6 0 3 3 0 016 0zM2 15a6 6 0 1112 0H2z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"کاربران اختصاصی شما"),e("p",{class:"text-xs text-gray-500"},"لیست کاربران (مشتریان) مرتبط با شرکت شما")])])],-1)),e("div",null,[y.user.clients&&y.user.clients.length?(n(),i("div",_e,[e("ul",ke,[(n(!0),i(N,null,A(y.user.clients,o=>(n(),i("li",{key:o.id,class:"flex items-center justify-between px-4 py-3 hover:bg-gray-50 transition-colors duration-150"},[e("div",Ce,[e("div",Ve,r(o.name),1),e("div",$e,[s[21]||(s[21]=e("span",{class:"font-medium text-gray-600"},"کد پرسنلی:",-1)),C(" "+r(o.personal_code)+" ",1),s[22]||(s[22]=e("span",{class:"mx-2"},"•",-1)),C(" "+r(o.phone),1)])]),e("div",Me,[e("button",{onClick:D=>E(o),class:"text-sm px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer"},"ویرایش",8,je),e("button",{onClick:D=>B(o),class:"text-sm px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer"},"حذف",8,Se)])]))),128))])])):(n(),i("div",Ee," هیچ کاربری به شما اختصاص داده نشده است. ")),k.value?(n(),i("div",ze,[e("div",{class:"absolute inset-0 bg-black/40",onClick:V}),e("div",Be,[s[26]||(s[26]=e("h4",{class:"text-lg font-semibold mb-3"},"ویرایش کاربر",-1)),e("div",Ue,[e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm text-gray-700 mb-1 text-gray-400"},"نام",-1)),m(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>a.name=o),type:"text",class:"w-full border text-black rounded-lg px-3 py-2"},null,512),[[b,a.name]])]),e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm text-gray-700 mb-1"},"کد پرسنلی",-1)),m(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>a.personal_code=o),type:"text",class:"w-full text-black border rounded-lg px-3 py-2"},null,512),[[b,a.personal_code]])]),e("div",null,[s[25]||(s[25]=e("label",{class:"block text-sm text-gray-700 mb-1"},"تلفن",-1)),m(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>a.phone=o),type:"text",class:"w-full border text-black rounded-lg px-3 py-2"},null,512),[[b,a.phone]])]),e("div",{class:"flex items-center gap-3 justify-end"},[e("button",{onClick:V,class:"px-4 py-2 text-white rounded-lg border cursor-pointer bg-red-400 hover:bg-red-500"},"انصراف"),e("button",{onClick:z,class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"},"ذخیره")])])])])):g("",!0),v.value?(n(),i("div",Fe,[e("div",{class:"absolute inset-0 bg-black/40",onClick:s[10]||(s[10]=o=>v.value=null)}),e("div",De,[s[27]||(s[27]=e("h4",{class:"text-lg font-semibold mb-3"},"حذف کاربر",-1)),s[28]||(s[28]=e("p",{class:"text-sm text-gray-700 mb-4"},"آیا مطمئن هستید که می‌خواهید این کاربر را حذف کنید؟ این عمل برگشت‌ناپذیر است.",-1)),e("div",He,[e("button",{onClick:s[11]||(s[11]=o=>v.value=null),class:"px-4 py-2 rounded-lg border"},"انصراف"),e("button",{onClick:U,class:"px-4 py-2 rounded-lg bg-red-600 text-white"},"حذف")])])])):g("",!0)])])])])])]),_:1}))}};export{Le as default};
