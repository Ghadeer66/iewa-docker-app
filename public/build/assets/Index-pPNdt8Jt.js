import{e as d,o as a,a as e,t as r,l as C,h as H,g as w,r as u,i as $,c as L,w as N,b as j,j as b,d as m,v,F as A,f as O}from"./app-_1bVVanu.js";const T={class:"min-h-screen bg-gray-100"},I={class:"bg-white shadow-sm border-b"},X={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},q={class:"flex justify-between items-center py-4"},G={class:"flex items-center space-x-4 space-x-reverse"},J={class:"text-gray-700 mx-4"},K={__name:"BusinessAppLayout",setup(g){const c=()=>{w.post("/business/logout")};return(p,i)=>(a(),d("div",T,[e("header",I,[e("div",X,[e("div",q,[i[1]||(i[1]=e("div",{class:"flex items-center"},[e("h1",{class:"text-2xl font-bold text-blue-600"},"پنل شرکت")],-1)),e("div",G,[e("span",J,r(p.$page.props.auth.user.business_name),1),e("button",{onClick:c,class:"flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white font-medium px-5 py-2 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-red-400"},i[0]||(i[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h4a2 2 0 012 2v1"})],-1),C(" خروج ",-1)]))])])])]),e("main",null,[H(p.$slots,"default")])]))}},P={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Q={class:"bg-white overflow-hidden shadow rounded-lg mb-8"},R={class:"px-4 py-5 sm:p-6"},W={class:"text-lg font-semibold text-gray-900"},Y={class:"mt-2 text-sm text-gray-600"},Z={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ee={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},se={class:"px-6 py-6"},te={class:"block"},le={class:"relative border-2 border-dashed rounded-xl p-6 text-center hover:bg-gray-50 transition"},oe={class:"text-gray-600"},ne={key:0,class:"mt-2 text-xs text-gray-500 truncate"},ae={class:"flex items-center gap-3"},re=["disabled"],de={class:"min-h-5"},ie={key:0,class:"text-sm text-green-600"},ue={key:1,class:"text-sm text-red-600"},ce={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},pe={class:"px-6 py-6"},xe={class:"md:col-span-2 flex items-center gap-3 mt-2"},be=["disabled"],me={class:"min-h-5"},ve={key:0,class:"text-sm text-green-600"},ge={key:1,class:"text-sm text-red-600"},ye={class:"mt-8"},fe={class:"bg-white overflow-hidden shadow rounded-2xl border border-gray-100"},he={class:"px-6 py-6"},we={key:0,class:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden text-black"},_e={class:"divide-y divide-gray-200"},ke={class:"flex-1"},Ce={class:"text-sm font-semibold text-gray-800"},Ve={class:"text-xs text-gray-500 mt-0.5"},$e={class:"flex items-center gap-2"},je=["onClick"],Se=["onClick"],Ee={key:1,class:"text-sm text-gray-500 bg-gray-50 border border-dashed border-gray-300 rounded-xl p-4 text-center"},ze={key:2,class:"fixed inset-0 flex items-center justify-center z-50"},Be={class:"bg-white rounded-xl shadow-lg p-6 z-10 w-full max-w-md"},Me={class:"space-y-3"},Fe={key:3,class:"fixed inset-0 flex items-center justify-center z-50"},Ue={class:"bg-white rounded-xl shadow-lg p-6 z-10 w-full max-w-sm"},De={class:"flex justify-end gap-3"},Le={__name:"Index",props:{user:Object,stats:Object},setup(g){const c=u(null),p=u(!1),i=u(""),y=u(""),S=t=>{c.value=t.target.files?.[0]||null},E=async()=>{if(i.value="",y.value="",!c.value){y.value="لطفاً فایل CSV را انتخاب کنید";return}const t=new FormData;t.append("file",c.value),p.value=!0;try{await w.post("/business/employees/upload",t,{forceFormData:!0,onSuccess:s=>{i.value=s?.props?.flash?.message||"آپلود انجام شد",c.value=null},onError:s=>{y.value=s?.file?.[0]||s?.message||"خطا در آپلود"},onFinish:()=>{p.value=!1}})}catch{y.value="خطای غیرمنتظره در آپلود",p.value=!1}},n=$({personal_code:"",percentage:null,starts_at:"",ends_at:""}),h=u(!1),_=u(""),f=u(""),k=u(null),x=u(null),o=$({id:null,name:"",personal_code:"",phone:""}),z=t=>{k.value=t.id,o.id=t.id,o.name=t.name||"",o.personal_code=t.personal_code||"",o.phone=t.phone||""},V=()=>{k.value=null,o.id=null},B=async()=>{try{await w.put(`/business/employees/${o.id}`,{name:o.name,personal_code:o.personal_code,phone:o.phone},{onSuccess:t=>{k.value=null},onError:t=>{console.error(t)}})}catch(t){console.error(t)}},M=t=>{x.value=t},F=async()=>{if(x.value)try{await w.delete(`/business/employees/${x.value.id}`,{onSuccess:()=>{x.value=null},onError:t=>{console.error(t)}})}catch(t){console.error(t)}},U=async()=>{if(_.value="",f.value="",!n.personal_code||!n.percentage){f.value="کد پرسنلی و درصد الزامی است";return}h.value=!0;try{await w.post("/business/employees/subsidy-by-code",{personal_code:n.personal_code,percentage:n.percentage,starts_at:n.starts_at||null,ends_at:n.ends_at||null},{onSuccess:t=>{_.value=t?.props?.flash?.message||"سوبسید ذخیره شد"},onError:t=>{f.value=t?.personal_code?.[0]||t?.percentage?.[0]||t?.message||"خطا در ذخیره"},onFinish:()=>{h.value=!1}})}catch{f.value="خطای غیرمنتظره",h.value=!1}};return(t,s)=>(a(),L(K,null,{default:N(()=>[e("div",P,[e("div",Q,[e("div",R,[e("h2",W,"خوش آمدید، "+r(g.user.name),1),e("p",Y,"شما به عنوان نماینده "+r(g.user.business_name)+" وارد شده‌اید. ",1)])]),e("div",Z,[e("div",ee,[e("div",se,[s[11]||(s[11]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-blue-50 text-blue-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 3a2 2 0 00-2 2v8a2 2 0 002 2h4l2 2 2-2h2a2 2 0 002-2V9l-5-6H4z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"آپلود کارکنان (CSV)"),e("p",{class:"text-xs text-gray-500"},"ستون‌های لازم: name, phone, personal code")])],-1)),e("form",{onSubmit:j(E,["prevent"]),class:"space-y-4"},[e("label",te,[s[10]||(s[10]=e("span",{class:"block text-sm text-gray-700 mb-2"},"فایل CSV",-1)),e("div",le,[e("input",{type:"file",accept:".csv,.txt",onChange:S,class:"absolute inset-0 opacity-0 cursor-pointer"},null,32),e("div",oe,[s[9]||(s[9]=e("span",{class:"text-sm"},"فایل را اینجا رها کنید یا برای انتخاب کلیک کنید",-1)),c.value?(a(),d("div",ne,r(c.value.name),1)):b("",!0)])])]),e("div",ae,[e("button",{disabled:p.value,type:"submit",class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 cursor-pointer"},r(p.value?"در حال آپلود...":"آپلود"),9,re)]),e("div",de,[i.value?(a(),d("span",ie,r(i.value),1)):b("",!0),y.value?(a(),d("span",ue,r(y.value),1)):b("",!0)])],32)])]),e("div",ce,[e("div",pe,[s[16]||(s[16]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-emerald-50 text-emerald-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11V5H9v2H7v2h2v2h2v-2h2V7h-2z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"تعریف سوبسید کارمند"),e("p",{class:"text-xs text-gray-500"},"کد پرسنلی را وارد کنید و درصد را تنظیم کنید")])],-1)),e("form",{onSubmit:j(U,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end text-black"},[e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm text-gray-700 mb-1"},"کد پرسنلی کاربر",-1)),m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>n.personal_code=l),type:"text",class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"مثلاً XA123"},null,512),[[v,n.personal_code]])]),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm text-gray-700 mb-1"},"درصد",-1)),m(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>n.percentage=l),type:"number",min:"1",max:"100",class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"1-100"},null,512),[[v,n.percentage,void 0,{number:!0}]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm text-gray-700 mb-1"},"از تاریخ",-1)),m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>n.starts_at=l),type:"date",class:"w-full border rounded-lg px-3 py-2"},null,512),[[v,n.starts_at]])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm text-gray-700 mb-1"},"تا تاریخ",-1)),m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>n.ends_at=l),type:"date",class:"w-full border rounded-lg px-3 py-2"},null,512),[[v,n.ends_at]])]),e("div",xe,[e("button",{disabled:h.value,type:"submit",class:"px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white disabled:opacity-50 cursor-pointer"},r(h.value?"در حال ذخیره...":"ذخیره سوبسید"),9,be),e("div",me,[_.value?(a(),d("span",ve,r(_.value),1)):b("",!0),f.value?(a(),d("span",ge,r(f.value),1)):b("",!0)])])],32)])])]),e("div",ye,[e("div",fe,[e("div",he,[s[25]||(s[25]=e("div",{class:"flex items-center justify-between mb-4"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 flex items-center justify-center rounded-xl bg-gray-50 text-gray-700"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13 7a3 3 0 11-6 0 3 3 0 016 0zM2 15a6 6 0 1112 0H2z"})])]),e("div",null,[e("h3",{class:"text-base font-semibold text-gray-900"},"کاربران اختصاصی شما"),e("p",{class:"text-xs text-gray-500"},"لیست کاربران (مشتریان) مرتبط با شرکت شما")])])],-1)),e("div",null,[g.user.clients&&g.user.clients.length?(a(),d("div",we,[e("ul",_e,[(a(!0),d(A,null,O(g.user.clients,l=>(a(),d("li",{key:l.id,class:"flex items-center justify-between px-4 py-3 hover:bg-gray-50 transition-colors duration-150"},[e("div",ke,[e("div",Ce,r(l.name),1),e("div",Ve,[s[17]||(s[17]=e("span",{class:"font-medium text-gray-600"},"کد پرسنلی:",-1)),C(" "+r(l.personal_code)+" ",1),s[18]||(s[18]=e("span",{class:"mx-2"},"•",-1)),C(" "+r(l.phone),1)])]),e("div",$e,[e("button",{onClick:D=>z(l),class:"text-sm px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer"},"ویرایش",8,je),e("button",{onClick:D=>M(l),class:"text-sm px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer"},"حذف",8,Se)])]))),128))])])):(a(),d("div",Ee," هیچ کاربری به شما اختصاص داده نشده است. ")),k.value?(a(),d("div",ze,[e("div",{class:"absolute inset-0 bg-black/40",onClick:V}),e("div",Be,[s[22]||(s[22]=e("h4",{class:"text-lg font-semibold mb-3"},"ویرایش کاربر",-1)),e("div",Me,[e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm text-gray-700 mb-1 text-gray-400"},"نام",-1)),m(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>o.name=l),type:"text",class:"w-full border text-black rounded-lg px-3 py-2"},null,512),[[v,o.name]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm text-gray-700 mb-1"},"کد پرسنلی",-1)),m(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>o.personal_code=l),type:"text",class:"w-full text-black border rounded-lg px-3 py-2"},null,512),[[v,o.personal_code]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm text-gray-700 mb-1"},"تلفن",-1)),m(e("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>o.phone=l),type:"text",class:"w-full border text-black rounded-lg px-3 py-2"},null,512),[[v,o.phone]])]),e("div",{class:"flex items-center gap-3 justify-end"},[e("button",{onClick:V,class:"px-4 py-2 text-white rounded-lg border cursor-pointer bg-red-400 hover:bg-red-500"},"انصراف"),e("button",{onClick:B,class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"},"ذخیره")])])])])):b("",!0),x.value?(a(),d("div",Fe,[e("div",{class:"absolute inset-0 bg-black/40",onClick:s[7]||(s[7]=l=>x.value=null)}),e("div",Ue,[s[23]||(s[23]=e("h4",{class:"text-lg font-semibold mb-3"},"حذف کاربر",-1)),s[24]||(s[24]=e("p",{class:"text-sm text-gray-700 mb-4"},"آیا مطمئن هستید که می‌خواهید این کاربر را حذف کنید؟ این عمل برگشت‌ناپذیر است.",-1)),e("div",De,[e("button",{onClick:s[8]||(s[8]=l=>x.value=null),class:"px-4 py-2 rounded-lg border"},"انصراف"),e("button",{onClick:F,class:"px-4 py-2 rounded-lg bg-red-600 text-white"},"حذف")])])])):b("",!0)])])])])])]),_:1}))}};export{Le as default};
